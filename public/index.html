<!DOCTYPE html>
<html>
  <head>
    <title>Object Detection</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
      #cameraButton {
        display: block;
        margin: 0 auto;
        font-size: 20px;
        padding: 10px;
      }

      #result {
        display: none;
        margin-top: 10px;
        font-size: 24px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <button id="cameraButton" onclick="toggleCamera()">Turn On Camera</button>
    <div id="result"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ml5.js/1.0.0/ml5.min.js"></script>
    <script>
      let video;
      let classifier;
      const cameraButton = document.getElementById("cameraButton");
      const result = document.getElementById("result");

      // Add event listener to camera button
      function toggleCamera() {
        if (cameraButton.innerHTML === "Turn On Camera") {
          startCamera();
          cameraButton.innerHTML = "Turn Off Camera";
        } else {
          stopCamera();
          cameraButton.innerHTML = "Turn On Camera";
        }
      }

      // Start the camera and object detection
      function startCamera() {
        // Check if browser supports mediaDevices
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
          // Get access to camera
          navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
              // Create video element
              video = document.createElement("video");
              video.srcObject = stream;
              video.play();

              // Add video element to page
              document.body.appendChild(video);

              // Load model
              ml5.imageClassifier("MobileNet", modelLoaded);

              // Callback function for when model is loaded
              function modelLoaded() {
                console.log("Model loaded");
              }

              // Create canvas element for drawing
              const canvas = document.createElement("canvas");
              const ctx = canvas.getContext("2d");
              canvas.width = video.width;
              canvas.height = video.height;
              document.body.appendChild(canvas);

              // Draw video frames onto canvas
              function draw() {
                ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
                classifier.classify(canvas, (err, results) => {
                  if (err) {
                    console.error(err);
                  } else {
                    // Show result in UI
                    result.style.display = "block";
                    result.innerText = `Detected object: ${results[0].label}`;
                  }
                });
                requestAnimationFrame(draw);
              }

              // Start drawing video frames
              requestAnimationFrame(draw);

            })
            .catch(error => {
              console.error("Error accessing camera", error);
            });
        } else {
          console.error("MediaDevices not supported");
        }
      }

      // Stop the camera and object detection
      function stopCamera() {
        video.srcObject.getTracks().forEach(track => track.stop());
        video.remove();
        classifier = null;
        result.style.display = "none";
      }
    </script>
  </body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Словарь</title>
    <style>
        :root {
            --word-font-size: 20px;
            --word-width: 100px;
        }

        body { 
            font-family: 'Arial', sans-serif; 
            text-align: center; 
            background-color: #f5f5f5; 
        }

        .container { 
            width: 90%; 
            max-width: 400px; 
            margin: auto; 
            background: white; 
            padding: 20px; 
            border-radius: 10px; 
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1); 
        }

        h1 { margin-bottom: 10px; }

        .controls, .sorting, .settings { margin-bottom: 10px; }

        textarea, button, select { 
            margin: 5px; 
            padding: 8px; 
            font-size: 16px; 
            width: calc(100% - 20px); 
        }

        ul { list-style: none; padding: 0; }

        li { 
            background: #fff; 
            margin: 5px 0; 
            padding: 10px; 
            border-radius: 5px; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.1); 
        }

        .index-number { font-size: 18px; font-weight: bold; color: #555; }

        .word { 
            font-size: var(--word-font-size);
            font-weight: bold; 
            color: #333; 
            width: var(--word-width);
            display: inline-block;
        }

        .transcription { font-size: 16px; font-style: italic; color: #777; }

        .translation { font-size: 18px; color: #000; }

        .delete-btn { 
            background: red; 
            color: white; 
            border: none; 
            width: 25px; 
            height: 25px; 
            cursor: pointer; 
            border-radius: 5px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }

        .settings button {
            padding: 5px 10px;
            font-size: 14px;
            margin: 2px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Словарь</h1>
        <div class="controls">
            <textarea id="wordInput" placeholder="Введите слова (каждое с новой строки)"></textarea>
            <button onclick="addWords()">Добавить</button>
        </div>
        <div class="sorting">
            <label>Сортировать по:</label>
            <select id="sortType" onchange="sortWords()">
                <option value="alpha">Алфавиту</option>
                <option value="date">Дате добавления</option>
            </select>
            <select id="sortOrder" onchange="sortWords()">
                <option value="asc">По возрастанию</option>
                <option value="desc">По убыванию</option>
            </select>
        </div>

        <div class="settings">
            <h3>Настройки отображения</h3>
            <button onclick="changeFontSize(2)">Увеличить шрифт</button>
            <button onclick="changeFontSize(-2)">Уменьшить шрифт</button>
            <button onclick="changeWordWidth(20)">Увеличить ширину</button>
            <button onclick="changeWordWidth(-20)">Уменьшить ширину</button>
        </div>

        <ul id="wordList"></ul>
    </div>

    <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-app.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/11.3.1/firebase-database.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBmGvAZcROpJCq4Di1h1z-Amr5uH3vtgy4",
        authDomain: "mydictionary-fca66.firebaseapp.com",
        databaseURL: "https://mydictionary-fca66-default-rtdb.firebaseio.com",
        projectId: "mydictionary-fca66",
        storageBucket: "mydictionary-fca66.appspot.com",
        messagingSenderId: "461562781840",
        appId: "1:461562781840:web:9cfac4ad241d8a3657b815"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const wordsRef = ref(db, "words");

    window.addWords = function () {
        let inputText = document.getElementById("wordInput").value.trim();
        if (!inputText) {
            alert("Пожалуйста, введите слова.");
            return;
        }

        let lines = inputText.split("\n").map(line => line.trim()).filter(line => line);
        let hasError = false;

        lines.forEach(line => {
            let parts = line.match(/^([A-Za-zА-Яа-я\s]+)\s+\[(.*?)\]\s+–\s+(.*)$/);
            if (!parts) {
                alert(`Некорректный формат: "${line}". Используйте формат: Слово [Транскрипция] – Перевод`);
                hasError = true;
                return;
            }

            push(wordsRef, {
                word: parts[1].trim(),
                transcription: parts[2].trim(),
                translation: parts[3].trim(),
                addedAt: new Date().getTime()
            }).catch((error) => {
                console.error("Ошибка при добавлении слова: ", error);
                alert("Произошла ошибка при добавлении слова. Попробуйте снова.");
            });
        });

        if (!hasError) {
            document.getElementById("wordInput").value = "";
            alert("Слова успешно добавлены!");
        }
    };

    window.deleteWord = function (key) {
        if (confirm("Вы уверены, что хотите удалить это слово?")) {
            remove(ref(db, `words/${key}`)).catch((error) => {
                console.error("Ошибка при удалении слова: ", error);
                alert("Произошла ошибка при удалении слова. Попробуйте снова.");
            });
        }
    };

    function renderWords(snapshot) {
        let list = document.getElementById("wordList");
        list.innerHTML = "";
        let words = [];

        snapshot.forEach(child => {
            let wordObj = child.val();
            words.push({ key: child.key, ...wordObj });
        });

        sortWords(words);
    }

    window.sortWords = function (words = null) {
        if (!words) {
            words = [];
            onValue(wordsRef, (snapshot) => {
                snapshot.forEach(child => {
                    let wordObj = child.val();
                    words.push({ key: child.key, ...wordObj });
                });
                sortWords(words);
            }, { onlyOnce: true });
            return;
        }

        let sortType = document.getElementById("sortType").value;
        let sortOrder = document.getElementById("sortOrder").value;

        words.sort((a, b) => sortType === "alpha" ? a.word.localeCompare(b.word) : a.addedAt - b.addedAt);
        if (sortOrder === "desc") words.reverse();

        let list = document.getElementById("wordList");
        list.innerHTML = "";

        words.forEach((wordObj, index) => {
            let li = document.createElement("li");
            li.innerHTML = `<span class="index-number">${index + 1}.</span> 
                            <span class="word">${wordObj.word}</span> 
                            <span class="transcription">[${wordObj.transcription}]</span> 
                            <span class="translation">– ${wordObj.translation}</span> 
                            <button class="delete-btn" onclick="deleteWord('${wordObj.key}')">X</button>`;
            list.appendChild(li);
        });
    };

    window.changeFontSize = (delta) => {
        let root = document.documentElement;
        let currentSize = parseInt(getComputedStyle(root).getPropertyValue('--word-font-size'));
        let newSize = Math.max(12, Math.min(40, currentSize + delta)); // Ограничение от 12px до 40px
        root.style.setProperty('--word-font-size', `${newSize}px`);
        localStorage.setItem('wordFontSize', newSize);
    };

    window.changeWordWidth = (delta) => {
        let root = document.documentElement;
        let currentWidth = parseInt(getComputedStyle(root).getPropertyValue('--word-width')) || 100;
        let newWidth = Math.max(50, Math.min(300, currentWidth + delta)); // Ограничение от 50px до 300px
        root.style.setProperty('--word-width', `${newWidth}px`);
        localStorage.setItem('wordWidth', newWidth);
    };

    // Восстановление настроек при загрузке
    window.onload = () => {
        let savedFontSize = localStorage.getItem('wordFontSize');
        if (savedFontSize) {
            document.documentElement.style.setProperty('--word-font-size', `${savedFontSize}px`);
        }

        let savedWordWidth = localStorage.getItem('wordWidth');
        if (savedWordWidth) {
            document.documentElement.style.setProperty('--word-width', `${savedWordWidth}px`);
        }

        onValue(wordsRef, renderWords);
    };
    </script>
</body>
</html>